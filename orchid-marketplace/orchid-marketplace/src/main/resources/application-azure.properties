# ========================
# AZURE PRODUCTION PROFILE
# ========================
# Activate with: --spring.profiles.active=azure
# or environment variable: SPRING_PROFILES_ACTIVE=azure

# Application
spring.application.name=orchid-marketplace

# ========================
# AZURE DATABASE CONFIGURATION
# ========================
spring.datasource.url=jdbc:postgresql://${AZURE_POSTGRESQL_HOST}:5432/orchid_db?sslmode=require
spring.datasource.username=${AZURE_POSTGRESQL_USERNAME}
spring.datasource.password=${AZURE_POSTGRESQL_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection Pool (optimized for Azure)
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# ========================
# JPA/HIBERNATE SETTINGS
# ========================
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.open-in-view=false

# ========================
# LIQUIBASE
# ========================
spring.liquibase.change-log=classpath:db/changelog/db.changelog-master.xml
spring.liquibase.enabled=true

# ========================
# AZURE BLOB STORAGE
# ========================
azure.storage.enabled=true
azure.storage.connection-string=${AZURE_STORAGE_CONNECTION_STRING}
azure.storage.container.product-images=product-images
azure.storage.container.store-images=store-images

# ========================
# AZURE CACHE FOR REDIS
# ========================
spring.data.redis.enabled=true
spring.data.redis.host=${AZURE_REDIS_HOST}
spring.data.redis.port=6380
spring.data.redis.ssl.enabled=true
spring.data.redis.password=${AZURE_REDIS_PASSWORD}
spring.data.redis.timeout=5000ms
spring.data.redis.connect-timeout=3000ms
spring.cache.type=redis
spring.cache.redis.time-to-live=3600000

# ========================
# AZURE KEY VAULT
# ========================
spring.cloud.azure.keyvault.secret.enabled=true
spring.cloud.azure.keyvault.secret.endpoint=${AZURE_KEYVAULT_ENDPOINT}

# ========================
# JWT (sourced from Key Vault)
# ========================
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:86400000}

# ========================
# STRIPE (from Key Vault)
# ========================
stripe.secret-key=${STRIPE_SECRET_KEY}
stripe.webhook-secret=${STRIPE_WEBHOOK_SECRET}
stripe.connect-client-id=${STRIPE_CONNECT_CLIENT_ID}
stripe.connect-redirect-uri=${STRIPE_CONNECT_REDIRECT_URI}

# ========================
# SERVER CONFIGURATION
# ========================
server.port=8080
server.servlet.context-path=/
server.forward-headers-strategy=native
server.compression.enabled=true
server.compression.mime-types=application/json,text/html,text/xml,text/plain

# ========================
# FILE UPLOAD
# ========================
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# ========================
# LOGGING (Azure Monitor Integration)
# ========================
logging.level.com.orchid=INFO
logging.level.org.springframework=WARN
logging.level.org.hibernate.SQL=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ========================
# ACTUATOR (for health checks)
# ========================
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true
